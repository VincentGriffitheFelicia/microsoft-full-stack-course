@page "/register/{Id:int}"
@inject NavigationManager NavigationManager

<h3>Register for Event</h3>

@if (!SessionService.IsLoggedIn)
{
    <p>You must be logged in to register for events.</p>
    <a href="/login" class="btn btn-primary">Login</a>
}
else if (evt == null)
{
    <p>Event not found.</p>
}
else
{
    <div>
        <p><strong>@evt.Name</strong> â€” @evt.Date.ToString("MMM d, yyyy") &middot; @evt.Location</p>
        <p>Registering as: @SessionService.CurrentUser!.Name (@SessionService.CurrentUser.Email)</p>
        <button class="btn btn-success" @onclick="Submit">Register</button>
    </div>
}

@code {
    [Parameter] public int Id { get; set; }
    private EventModel? evt;

    protected override void OnInitialized()
    {
        evt = EventService.GetById(Id);
    }

    private void Submit()
    {
        if (!SessionService.IsLoggedIn || evt == null) return;
        var attendance = new AttendanceModel
        {
            UserId = SessionService.CurrentUser!.Id,
            EventId = evt.Id
        };
        AttendanceService.Add(attendance);
        NavigationManager.NavigateTo("/events");
    }
}
